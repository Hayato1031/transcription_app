import React, { useState, useEffect } from 'react';
import { Mic, StopCircle, Save, Trash2, Settings } from 'lucide-react';

// éŸ³å£°èªè­˜ã®çŠ¶æ…‹ã‚’æ¨¡æ“¬ã™ã‚‹ãŸã‚ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆ
const sampleTranscriptions = [
  "ã“ã‚“ã«ã¡ã¯ã€éŸ³å£°èªè­˜ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚",
  "ã“ã®æ–‡å­—èµ·ã“ã—ã‚¢ãƒ—ãƒªã¯ã€ä¼šè©±ã‚’è‡ªå‹•çš„ã«ãƒ†ã‚­ã‚¹ãƒˆã«å¤‰æ›ã—ã¾ã™ã€‚",
  "ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨éŒ²éŸ³ãŒé–‹å§‹ã•ã‚Œã€åœæ­¢ãƒœã‚¿ãƒ³ã§çµ‚äº†ã—ã¾ã™ã€‚",
  "æ–‡å­—èµ·ã“ã—ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã¯ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚",
  "ä¿å­˜ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜ã§ãã¾ã™ã€‚"
];

const TranscriptionApp = () => {
  const [isRecording, setIsRecording] = useState(false);
  const [transcription, setTranscription] = useState("");
  const [savedTranscriptions, setSavedTranscriptions] = useState([]);
  const [elapsedTime, setElapsedTime] = useState(0);
  const [darkMode, setDarkMode] = useState(false);
  
  // éŒ²éŸ³ä¸­ã®æ™‚é–“ã‚’æ›´æ–°ã™ã‚‹
  useEffect(() => {
    let timer;
    if (isRecording) {
      timer = setInterval(() => {
        setElapsedTime(prev => prev + 1);
        
        // æ¨¡æ“¬: æ–°ã—ã„ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ 
        if (elapsedTime % 5 === 0 && elapsedTime < sampleTranscriptions.length * 5) {
          const newText = sampleTranscriptions[Math.floor(elapsedTime / 5)];
          setTranscription(prev => prev + " " + newText);
        }
      }, 1000);
    } else {
      clearInterval(timer);
    }
    
    return () => clearInterval(timer);
  }, [isRecording, elapsedTime]);
  
  const startRecording = () => {
    setIsRecording(true);
    setElapsedTime(0);
    setTranscription("");
  };
  
  const stopRecording = () => {
    setIsRecording(false);
  };
  
  const saveTranscription = () => {
    if (transcription.trim()) {
      setSavedTranscriptions([...savedTranscriptions, transcription]);
      setTranscription("");
    }
  };
  
  const clearTranscription = () => {
    setTranscription("");
  };
  
  const formatTime = (seconds) => {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  };
  
  // æ³¢å½¢ã®å‹•ãã‚’è¡¨ç¾ã™ã‚‹é–¢æ•°ï¼ˆéŒ²éŸ³ä¸­ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰
  const WaveformAnimation = () => {
    return (
      <div className="flex items-center justify-center gap-1">
        {[...Array(5)].map((_, i) => (
          <div 
            key={i}
            className={`w-1 bg-rose-400 rounded-full animate-pulse`} 
            style={{
              height: `${8 + (i % 3) * 4}px`,
              animationDelay: `${i * 0.2}s`
            }}
          ></div>
        ))}
      </div>
    );
  };
  
  const bgColor = darkMode ? 'bg-gray-900' : 'bg-gray-50';
  const cardBg = darkMode ? 'bg-gray-800' : 'bg-white';
  const textColor = darkMode ? 'text-gray-100' : 'text-gray-800';
  const subTextColor = darkMode ? 'text-gray-400' : 'text-gray-500';
  
  return (
    <div className={`flex flex-col h-screen ${bgColor} transition-colors duration-300`}>
      {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
      <header className="p-4 bg-gradient-to-r from-violet-600 to-rose-500 text-white shadow-lg">
        <div className="flex justify-between items-center max-w-6xl mx-auto">
          <h1 className="text-xl font-bold tracking-tight">VOICE NOTE</h1>
          <div className="flex gap-3">
            <button 
              onClick={() => setDarkMode(!darkMode)}
              className="p-2 rounded-full hover:bg-white/20 transition-colors"
            >
              {darkMode ? 'â˜€ï¸' : 'ğŸŒ™'}
            </button>
            <button className="p-2 rounded-full hover:bg-white/20 transition-colors">
              <Settings size={20} />
            </button>
          </div>
        </div>
      </header>
      
      {/* ãƒ¡ã‚¤ãƒ³ */}
      <main className="flex-1 p-4 overflow-hidden flex flex-col max-w-6xl mx-auto w-full">
        {/* éŒ²éŸ³çŠ¶æ…‹ */}
        <div className={`${cardBg} rounded-xl shadow-lg p-4 mb-6 flex justify-between items-center backdrop-blur-sm bg-opacity-80 border ${darkMode ? 'border-gray-700' : 'border-gray-100'}`}>
          <div className="flex items-center gap-3">
            {isRecording ? (
              <div className="flex items-center gap-2">
                <div className="w-3 h-3 rounded-full bg-rose-500 animate-pulse"></div>
                <span className={`font-medium ${textColor}`}>éŒ²éŸ³ä¸­</span>
                <WaveformAnimation />
              </div>
            ) : (
              <div className="flex items-center gap-2">
                <div className="w-3 h-3 rounded-full bg-gray-300"></div>
                <span className={`font-medium ${textColor}`}>å¾…æ©Ÿä¸­</span>
              </div>
            )}
          </div>
          {isRecording && (
            <div className="text-rose-500 font-mono font-bold">{formatTime(elapsedTime)}</div>
          )}
        </div>
        
        {/* æ–‡å­—èµ·ã“ã—è¡¨ç¤ºã‚¨ãƒªã‚¢ */}
        <div className={`flex-1 ${cardBg} rounded-xl shadow-lg p-6 mb-6 overflow-auto backdrop-blur-sm bg-opacity-90 border ${darkMode ? 'border-gray-700' : 'border-gray-100'}`}>
          <div className="h-full">
            {transcription ? (
              <p className={`whitespace-pre-wrap leading-relaxed ${textColor}`}>{transcription}</p>
            ) : (
              <div className="flex flex-col items-center justify-center h-full">
                <div className="w-24 h-24 rounded-full bg-gradient-to-br from-violet-200 to-rose-200 flex items-center justify-center mb-4 opacity-60">
                  <Mic size={36} className={darkMode ? 'text-gray-800' : 'text-gray-600'} />
                </div>
                <p className={`${subTextColor} text-center`}>
                  {isRecording ? "éŸ³å£°ã‚’èªè­˜ã—ã¦ã„ã¾ã™..." : "ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦éŒ²éŸ³ã‚’é–‹å§‹ã—ã¦ãã ã•ã„"}
                </p>
              </div>
            )}
          </div>
        </div>
        
        {/* ä¿å­˜ã•ã‚ŒãŸæ–‡å­—èµ·ã“ã—ãƒªã‚¹ãƒˆ */}
        {savedTranscriptions.length > 0 && (
          <div className={`${cardBg} rounded-xl shadow-lg p-5 mb-6 max-h-40 overflow-auto backdrop-blur-sm bg-opacity-80 border ${darkMode ? 'border-gray-700' : 'border-gray-100'}`}>
            <h2 className={`text-sm font-bold ${textColor} mb-3`}>ä¿å­˜æ¸ˆã¿æ–‡å­—èµ·ã“ã—</h2>
            <div className="space-y-2">
              {savedTranscriptions.map((text, index) => (
                <div key={index} className={`p-3 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-gray-50'} text-sm ${textColor}`}>
                  {text.substring(0, 100)}...
                </div>
              ))}
            </div>
          </div>
        )}
        
        {/* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ */}
        <div className="flex justify-center gap-4 py-6">
          {!isRecording ? (
            <button 
              onClick={startRecording}
              className="p-5 bg-gradient-to-r from-violet-600 to-rose-500 text-white rounded-full shadow-xl hover:shadow-lg hover:from-violet-700 hover:to-rose-600 transition-all duration-300"
            >
              <Mic size={28} />
            </button>
          ) : (
            <button 
              onClick={stopRecording}
              className="p-5 bg-gradient-to-r from-red-500 to-rose-600 text-white rounded-full shadow-xl hover:shadow-lg hover:from-red-600 hover:to-rose-700 transition-all duration-300"
            >
              <StopCircle size={28} />
            </button>
          )}
          
          <button 
            onClick={saveTranscription}
            className={`p-5 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-full shadow-xl hover:shadow-lg hover:from-emerald-600 hover:to-teal-600 transition-all duration-300 ${!transcription.trim() && 'opacity-50 cursor-not-allowed'}`}
            disabled={!transcription.trim()}
          >
            <Save size={28} />
          </button>
          
          <button 
            onClick={clearTranscription}
            className={`p-5 ${darkMode ? 'bg-gray-700' : 'bg-gray-200'} ${darkMode ? 'text-white' : 'text-gray-600'} rounded-full shadow-xl hover:shadow-lg ${darkMode ? 'hover:bg-gray-600' : 'hover:bg-gray-300'} transition-all duration-300 ${!transcription.trim() && 'opacity-50 cursor-not-allowed'}`}
            disabled={!transcription.trim()}
          >
            <Trash2 size={28} />
          </button>
        </div>
      </main>
    </div>
  );
};

export default TranscriptionApp;